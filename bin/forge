#!/usr/bin/env php
<?php

use Sven\ForgeCLI\Commands\{
    Authorize, Certificates, Credentials, Daemons, Databases, Deployment,
    DeployScript, Env, FirewallRules, Jobs, MakeAlias, MysqlUsers, NginxConfig,
    Projects, QuickDeploy, Recipes, Servers, Services, SshKeys, Sites, Workers
};
use Sven\FileConfig\Drivers\Json;
use Sven\FileConfig\File;
use Sven\FileConfig\Store;

if (file_exists(__DIR__.'/../../../autoload.php')) {
    require __DIR__.'/../../../autoload.php';
} else {
    require __DIR__.'/../vendor/autoload.php';
}

// Get the configuration file to use for the application. By default,
// we will use the `$HOME` directory (`%USERPROFILE%` on Windows).
$home = PHP_OS_FAMILY === 'Windows' ? $_SERVER['USERPROFILE'] : $_SERVER['HOME'];
$configFile = $home.DIRECTORY_SEPARATOR.'forge.json';

if (! file_exists($configFile)) {
    file_put_contents($configFile, '{}');
}

$config = new Store(new File($configFile), new Json());

$app = new Symfony\Component\Console\Application('Forge CLI', '0.5.0');

$app->addCommands([
    new MakeAlias($config),
    new Authorize($config),
    new Credentials($config),
    new Servers\Make($config),
    new Servers\ListAll($config),
    new Servers\Show($config),
    new Servers\Update($config),
    new Servers\Delete($config),
    new Servers\Reboot($config),
    new Sites\Make($config),
    new Sites\ListAll($config),
    new Sites\Show($config),
    new Sites\Update($config),
    new Sites\Delete($config),
    new Sites\Deploy($config),
    new Services\Reboot($config),
    new Services\Stop($config),
    new Services\Install($config),
    new Services\Uninstall($config),
    new Daemons\ListAll($config),
    new Daemons\Make($config),
    new Daemons\Delete($config),
    new Daemons\Show($config),
    new Daemons\Reboot($config),
    new QuickDeploy\Disable($config),
    new QuickDeploy\Enable($config),
    new Deployment\GetLog($config),
    new Deployment\ResetState($config),
    new DeployScript\Get($config),
    new DeployScript\Update($config),
    new FirewallRules\ListAll($config),
    new FirewallRules\Make($config),
    new FirewallRules\Delete($config),
    new FirewallRules\Show($config),
    new Jobs\ListAll($config),
    new Jobs\Make($config),
    new Jobs\Delete($config),
    new Jobs\Show($config),
    new Databases\ListAll($config),
    new Databases\Make($config),
    new Databases\Delete($config),
    new Databases\Show($config),
    new MysqlUsers\ListAll($config),
    new MysqlUsers\Make($config),
    new MysqlUsers\Delete($config),
    new MysqlUsers\Show($config),
    new Workers\ListAll($config),
    new Workers\Make($config),
    new Workers\Delete($config),
    new Workers\Show($config),
    new Workers\Reboot($config),
    new Recipes\ListAll($config),
    new Recipes\Make($config),
    new Recipes\Delete($config),
    new Recipes\Show($config),
    new Recipes\Run($config),
    new Recipes\Update($config),
    new NginxConfig\Get($config),
    new NginxConfig\Update($config),
    new Env\Get($config),
    new Env\Update($config),
    new SshKeys\ListAll($config),
    new SshKeys\Make($config),
    new SshKeys\Delete($config),
    new SshKeys\Show($config),
    new Projects\DeleteGit($config),
    new Projects\DeleteWordpress($config),
    new Projects\InstallGit($config),
    new Projects\InstallWordpress($config),
    new Certificates\Activate($config),
    new Certificates\ListAll($config),
    new Certificates\Delete($config),
    new Certificates\Install($config),
    new Certificates\Make($config),
    new Certificates\Show($config),
]);

$app->run();
